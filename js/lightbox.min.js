console.clear();

// define images
let images = [
    {url:'assets/hsa_wartenbergstrasse/', src:'tim_ott_2024_09_hsa_wartenbergstrasse_068.jpg', project:'hsa_wartenbergstrasse', index:'0', mobileColumn:'4 / 14', mobileRow:'4 / 18', desktopColumn:'32 / 42', desktopRow:'4 / 18'},
    {url:'assets/hsa_wartenbergstrasse/', src:'tim_ott_2024_09_hsa_wartenbergstrasse_052c.jpg', project:'hsa_wartenbergstrasse', index:'1', mobileColumn:'2 / 16', mobileRow:'20 / 30', desktopColumn:'16 / 30', desktopRow:'6 / 16'},
    {url:'assets/hsa_wartenbergstrasse/', src:'tim_ott_2024_09_hsa_wartenbergstrasse_061.jpg', project:'hsa_wartenbergstrasse', index:'2'},
    {url:'assets/hsa_wartenbergstrasse/', src:'tim_ott_2024_09_hsa_wartenbergstrasse_048.jpg', project:'hsa_wartenbergstrasse', index:'3'},
    {url:'assets/hsa_gartenweg/', src:'tim_ott_2023_11_hsa_gartenweg_002.jpg', project:'hsa_gartenweg', index:'0', mobileColumn:'2 / 10', mobileRow:'50 / 52', desktopColumn:'34 / 44', desktopRow:'34 / 48'},
    {url:'assets/hsa_gartenweg/', src:'tim_ott_2023_11_hsa_gartenweg_053.jpg', project:'hsa_gartenweg', index:'1', mobileColumn:'2 / 10', mobileRow:'54 / 56', desktopColumn:'2 / 16', desktopRow:'26 / 36'}
];
console.log(images);

// append images, load lightbox
loadImages();
    function loadImages() {
    images.forEach((img) => {
        const lightbox = document.querySelector(".lightbox");
        const lightboxSrc = document.querySelector(".lightboxSrc");
        const lightboxCount = document.querySelector(".lightboxCount");
        const lightboxClose = document.querySelector(".lightboxClose");
        const lightboxPrev = document.querySelector(".lightboxPrev");
        const lightboxNext = document.querySelector(".lightboxNext");

        let imgContainer = document.createElement('div');
        imgContainer.className = "imgContainer";
        imgContainer.title = '\u00A9 tim ott';
        imgContainer.alt = '\u00A9 tim ott';
        imgContainer.style.backgroundImage = 'url(' + img.url + img.src + ')';
        imgContainer.style.backgroundRepeat = 'round';
        imgContainer.style.backgroundSize = 'cover';
        imgContainer.style.cursor = 'pointer';

        // define device breakpoints in pixels
        let breakpoints = [
            0,
            768
        ];
        defineScreenSize();
        function defineScreenSize() {
            if (window.innerWidth >= breakpoints[0] && window.innerWidth < breakpoints[1]) {
                gridColumn = img.mobileColumn;
                gridRow = img.mobileRow;
            } else if (window.innerWidth >= breakpoints[1]) {
                gridColumn = img.desktopColumn;
                gridRow = img.desktopRow;
            }
        };
        imgContainer.style.gridColumn = gridColumn;
        imgContainer.style.gridRow = gridRow;
        document.body.appendChild(imgContainer);
        document.querySelector('.gridContainer').appendChild(imgContainer);

        // set currentIndex to index value from selected images
        // push images with same project value as selected image to new array
        imgContainer.addEventListener('click', function() {
            let currentIndex = img.index;
            let imgSelection = images.filter((selected) => selected.project === img.project);
            let imgSelectionPath = [];
            imgSelection.forEach((selectedImage) => {
                imgSelectionPath.push(selectedImage.url + selectedImage.src);
            });

            console.log('current project: ' + img.project);
            console.log(imgSelection);
            console.log(imgSelectionPath);

            // open lightbox with selected image
            lightboxSrc.setAttribute("src", img.url + img.src);
            lightbox.style.display = "flex";
            lightboxSrc.style.objectFit = "contain";
            updateImage();
            disableScroll();

            // lightbox navigation
            // parseFloat(currentIndex) ensures currentIndex is a number: number = addition (2+5=7) / string = concatenation (2+5=25)
            document.onkeydown = checkKey;
            function checkKey(pressed) {
                if (pressed.keyCode == '37') {
                    cyclePrev();
                } else if (pressed.keyCode == '39') {
                    cycleNext();
                }
                updateImage();
            };

            // updates lightboxCount according to currentIndex
            function updateImage() {
                console.log('current project: ' + img.project + ', current image: ' + imgSelectionPath[currentIndex]);
                lightboxSrc.setAttribute("src", imgSelectionPath[currentIndex]);
                lightboxCount.textContent = `${parseFloat(currentIndex) + 1} / ${imgSelection.length}`;
            }

            lightboxClose.addEventListener("click", function() {
                closeLightbox();
                enableScroll();
            });
            lightboxPrev.addEventListener("click", function() {
                cyclePrev();
                updateImage();
            });
            lightboxNext.addEventListener("click", function() {
                cycleNext();
                updateImage();
            });
            function cyclePrev() {
                currentIndex = (parseFloat(currentIndex) - 1) < 0 ? imgSelectionPath.length - 1 : parseFloat(currentIndex) - 1;
                updateImage();
            };
            function cycleNext() {
                currentIndex = (parseFloat(currentIndex) + 1) >= imgSelectionPath.length ? 0 : parseFloat(currentIndex) + 1;
                updateImage();
            };
        });

        // listens for click outside of lightboxSrc
        lightbox.addEventListener("click", function(click) {
            if (click.target === lightbox) {
                click.preventDefault();
                closeLightbox();
                enableScroll();
            };
        });
        function closeLightbox() {
            lightbox.style.display = "none";
            lightboxSrc.style.objectFit = "cover";
        };
        function enableScroll() {
            document.body.style.overflow = '';
        };
        function disableScroll() {
            document.body.style.overflow = 'hidden';
        };
    });
};
window.addEventListener('resize', function () {
    document.querySelector('.gridContainer').textContent = '';
    loadImages();
});









// prevent arrow scrolling on safari
// needed?
window.addEventListener("keydown", function(e) {
    if(["Space","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
        e.preventDefault();
    }
}, false);